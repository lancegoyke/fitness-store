{% extends '_base.html' %}
{% load static %}

{% block title %}
  {{ challenge.name}} | {% include "_site_title.html" %}
{% endblock title %}

{% block content %}
  <div class="with-sidebar">
    <div>
      {% include "challenges/sidebar.html" %}

      <div>
        <div class="stack">
          <div>
            <a href="{% url 'challenge_filtered_list' %}">‚Üê view all</a>
          </div>

          <div>
            <h1>{{ challenge.name }}</h1>
          </div>

          <div class="box">
            <div class="stack">
              <div>
                {% for line in challenge.description.splitlines %}
                  <p>{{ line|safe }}</p>
                {% endfor %}
              </div>

              <div class="cluster categories">
                <div>
                  {% for tag in challenge.tags.all %}
                    <a class="tag" href="{% url 'challenge_tag_filtered_list' tag.slug %}">
                      {{ tag }}
                    </a>
                  {% endfor %}
                </div>
              </div>

              {% if user.is_superuser %}
                <div>
                  <a class="button invert" href="{% url 'admin:challenges_challenge_change' challenge.id %}">Admin</a>
                </div>
              {% endif %}
            </div>
          </div>

          {% if top_score %}
            <div class="two-switcher">
              <div>
                <div class="box {% if user_pr %}success{% else %}error{% endif %}">
                  <div class="stack">
                    <h4>Your PR</h4>
                    <p class="font-size:big" style="font-family: monospace;">
                      {% if user_pr %}
                        {{ user_pr }}
                      {% else %}
                        -
                      {% endif %}
                    </p>
                  </div>
                </div>

                {% if top_score %}
                  <div class="box info">
                    <div class="stack">
                      <h4>Top Score</h4>
                      <p class="font-size:big" style="font-family: monospace;">
                        {{ top_score }}
                      </p>
                    </div>
                  </div>
                {% endif %}
              </div>
            </div>
          {% endif %}

          <div class="box">
            <div class="stack">
              <h3>Submitted Scores</h3>
              {% if top_score %}
                <div style="font-family: monospace; font-size: var(--s-1);">
                  <table>
                    <thead>
                      <tr>
                        <th>Time</th>
                        <th>User</th>
                        <th>Date</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for record in filter.qs %}
                        <tr {% if user == record.user %}style="background-color: var(--success);"{% endif %}>
                          <td>{{ record.time_score }}</td>
                          <td>{{ record.user }}</td>
                          <td>{{ record.date_recorded|date:"SHORT_DATE_FORMAT" }}</td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              {% else %}
                <div>
                  <p><em>No scores available.</em></p>
                  <p>If you hurry, you might be the first to set a record for this one!</p>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}
